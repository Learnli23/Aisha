<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Attrition Dashboard</title>

  <!-- DataTables -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

  <!-- Fonts and Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/feather-icons"></script>

  <!-- jsPDF & autoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <style>
    :root {
      --primary-color: #0056b3;
      --text-color: #333;
      --background-light: #ffffff;
      --background-dark: #111827;
      --text-light: #f9fafb;
    }

    [data-theme="dark"] {
      --background-light: var(--background-dark);
      --text-color: var(--text-light);
    }

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: var(--background-light);
      color: var(--text-color);
      transition: background 0.3s, color 0.3s;
      padding: 2rem;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    nav {
      display: flex;
      gap: 1.5rem;
      align-items: center;
    }

    nav a {
      text-decoration: none;
      color: var(--text-color);
      font-weight: 500;
    }

    .toggle-theme {
      cursor: pointer;
      font-size: 1.5rem;
      color: var(--primary-color);
    }

    header {
      background: #1f2e49;
      color: white;
      padding: 1.5rem;
      text-align: center;
      font-size: 24px;
    }

    header h1 {
      margin: 0;
    }

    .student-data-section {
      margin-top: 3rem;
    }

    .filter-bar {
      margin: 1rem 0;
      text-align: center;
    }

    .filter-bar label {
      font-weight: bold;
    }

    .filter-bar select {
      padding: 8px;
      font-size: 1rem;
      margin-left: 10px;
    }

    table {
      width: 100%;
      margin-top: 2rem;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px;
      border: 1px solid #ddd;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

    td img.avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }

    .export-btn, .download-btn {
      background-color: #007bff;
      color: white;
      padding: 10px 15px;
      border: none;
      cursor: pointer;
      border-radius: 5px;
      margin: 10px;
    }

    .export-btn:hover, .download-btn:hover {
      background-color: #0056b3;
    }

    footer {
      margin-top: 3rem;
      text-align: center;
      font-size: 0.9rem;
      color: #666;
    }
  </style>
</head>

<body data-theme="light">

  <div class="logo">
    <a href="{% url 'home' %}">
      <i data-feather="bar-chart-2"></i> Great University
    </a>
  </div>

  <nav>
    <a href="{% url 'view_analysis_results' %}">Results</a>
    <a href="{% url 'dashboard' %}">Dashboard</a>
    <a href="{% url 'attrition_dashboard' %}">Analytics</a>
    <button class="toggle-theme" id="themeToggle">ðŸŒ™</button>
    <button id="downloadPDF" class="download-btn">
      <i data-feather="download"></i> Download PDF
    </button>
  </nav>

  <header>
    <h1>ðŸŽ“ Student Attrition Dashboard</h1>
  </header>

  <div class="student-data-section">
    <div class="filter-bar">
      <label for="statusFilter"><strong>Filter by Status:</strong></label>
      <select id="statusFilter">
        <option value="">All</option>
        <option value="High">High</option>
        <option value="Medium">Medium</option>
        <option value="Low">Low</option>
      </select>
    </div>

    <table id="studentTable" class="display">
      <thead>
        <tr>
          <th>#</th>
          <th>Picture</th>
          <th>Name</th>
          <th>Program</th>
          <th>Year</th>
          <th>GPA</th>
          <th>Faculty</th>
          <th>Age</th>
          <th>Sex</th>
          <th>Financial Status</th>
          <th>Risk Level</th>
          <th>Certainty Score (%)</th>
        </tr>
      </thead>
      <tbody>
        {% for result in results %}
        <tr>
          <td>{{ result.student.id }}</td>
          <td><img src="https://i.pravatar.cc/40?img=1" class="avatar" /></td>
          <td>{{ result.student.name }}</td>
          <td>{{ result.student.program }}</td>
          <td>{{ result.student.year }}</td>
          <td>{{ result.student.gpa }}</td>
          <td>{{ result.student.faculty }}</td>
          <td>{{ result.student.age }}</td>
          <td>{{ result.student.sex }}</td>
          <td>{{ result.student.financial_status }}</td>
          <td>{{ result.student.risk_level }}</td>
          <td>{{ result.certainty_score }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <footer>
    &copy; 2025 Great University - Student Analytics Dashboard
  </footer>

  <script>
    feather.replace();

    // Toggle theme
    document.getElementById('themeToggle').addEventListener('click', () => {
      const body = document.body;
      const theme = body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      body.setAttribute('data-theme', theme);
    });

    // DataTables init
    $(document).ready(function () {
      $('#studentTable').DataTable();
    });

    // PDF Download Function
    document.getElementById("downloadPDF").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.text("Student Attrition Dashboard", 14, 15);
      doc.autoTable({
        html: '#studentTable',
        startY: 25,
        theme: 'grid',
        styles: {
          font: 'poppins',
          fontSize: 8
        },
        headStyles: {
          fillColor: [0, 123, 255]
        },
        didDrawCell: (data) => {
          // Skip images in table for PDF
          if (data.column.index === 1 && data.cell.raw.querySelector('img')) {
            data.cell.text = '';
          }
        }
      });

      doc.save("student_attrition_report.pdf");
    });
  </script>
</body>

</html>
 
  
  
